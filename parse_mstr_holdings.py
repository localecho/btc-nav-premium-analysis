#!/usr/bin/env python3
"""
Parse MicroStrategy Bitcoin holdings from the purchases data
"""

import json
from datetime import datetime

# MicroStrategy Bitcoin purchase history based on Strategy.com data
# Format: (date, btc_acquired, avg_cost, total_cost_millions, cumulative_holdings)
mstr_purchases = [
    ("2020-08-11", 21454, 11111, 250, 21454),
    ("2020-09-15", 16796, 10419, 175, 38250),
    ("2020-12-04", 2574, 19427, 50, 40824),
    ("2020-12-21", 29646, 22000, 650, 70470),
    ("2021-01-22", 295, 33810, 10, 70765),
    ("2021-02-02", 10000, 37617, 295, 80765),
    ("2021-02-24", 19452, 52765, 1026, 90531),
    ("2021-03-05", 205, 48888, 10, 90736),
    ("2021-03-12", 262, 57146, 15, 90998),
    ("2021-04-05", 253, 59339, 15, 91251),
    ("2021-05-13", 229, 43663, 10, 91480),
    ("2021-05-18", 271, 49229, 13, 91751),
    ("2021-06-21", 13005, 37617, 489, 105085),
    ("2021-08-24", 3907, 45294, 177, 114042),
    ("2021-09-13", 5050, 48099, 243, 119092),
    ("2021-11-29", 7002, 59187, 414, 122477),
    ("2021-12-09", 1434, 57477, 82, 122477),
    ("2021-12-30", 1914, 49229, 94, 124391),
    ("2022-02-01", 660, 37865, 25, 125051),
    ("2022-04-05", 4167, 45714, 190, 129218),
    ("2022-06-29", 480, 20817, 10, 129698),
    ("2022-09-20", 301, 19851, 6, 129999),
    ("2022-12-28", 2501, 17847, 45, 132500),
    ("2023-03-23", 6455, 23238, 150, 138955),
    ("2023-04-05", 1045, 28016, 29, 140000),
    ("2023-06-28", 12333, 28136, 347, 152333),
    ("2023-08-01", 467, 30788, 14, 152800),
    ("2023-09-25", 5445, 27053, 147, 158245),
    ("2023-11-01", 155, 34495, 5, 158400),
    ("2023-11-30", 16130, 36785, 593, 174530),
    ("2023-12-27", 14620, 42110, 616, 189150),
    ("2024-02-06", 850, 43723, 37, 190000),
    ("2024-02-26", 3000, 51813, 155, 193000),
    ("2024-03-11", 12000, 68477, 822, 205000),
    ("2024-03-19", 9245, 67382, 623, 214245),
    ("2024-04-29", 155, 63397, 10, 214400),
    ("2024-06-20", 11931, 65883, 786, 226331),
    ("2024-08-01", 169, 67455, 11, 226500),
    ("2024-09-13", 18300, 60408, 1110, 244800),
    ("2024-09-20", 7420, 61750, 458, 252220),
    ("2024-11-11", 27200, 74463, 2025, 279420),
    ("2024-11-18", 51780, 88627, 4600, 331200),
    ("2024-11-25", 55500, 97862, 5400, 386700),
    ("2024-12-02", 15400, 95976, 1500, 402100),
    ("2024-12-09", 21550, 98783, 2100, 423650),
    ("2024-12-16", 15350, 100386, 1500, 439000),
    ("2024-12-23", 5262, 106662, 561, 444262),
    ("2024-12-30", 2138, 97837, 209, 446400),
    ("2025-01-06", 1070, 94004, 101, 447470),
    ("2025-01-13", 2530, 95972, 243, 450000),
    ("2025-01-21", 11000, 101191, 1100, 461000),
    ("2025-01-27", 10107, 105596, 1100, 471107),
    ("2025-02-10", 7633, 97255, 742, 478740),
    ("2025-02-24", 20356, 97514, 1985, 499096),
    ("2025-03-17", 130, 82981, 11, 499226),
    ("2025-03-24", 6911, 84529, 584, 506137),
    ("2025-03-31", 22048, 86969, 1918, 528185),
    ("2025-04-14", 3459, 82618, 286, 531644),
    ("2025-04-21", 6556, 84785, 556, 538200),
    ("2025-04-28", 15355, 92737, 1424, 553555),
    ("2025-05-05", 1895, 95167, 180, 555450),
    ("2025-05-12", 13390, 99856, 1337, 568840),
    ("2025-05-19", 7390, 103498, 765, 576230),
    ("2025-05-26", 4020, 106237, 427, 580250),
    ("2025-06-02", 705, 106495, 75, 580955),
    ("2025-06-09", 1045, 105426, 110, 582000),
    ("2025-06-16", 10100, 104080, 1051, 592100),
    ("2025-06-23", 245, 105856, 26, 592345),
    ("2025-06-30", 4980, 106801, 532, 597325),
    ("2025-07-14", 4225, 111827, 472, 601550),
    ("2025-07-21", 6220, 118940, 740, 607770),
    ("2025-07-29", 21021, 117256, 2465, 628791),
    ("2025-08-11", 155, 116401, 18, 628946),
    ("2025-08-18", 430, 119666, 51, 629376),
    ("2025-08-25", 3081, 115829, 357, 632457),
    ("2025-09-02", 4048, 110981, 449, 636505),
    ("2025-09-08", 1955, 111196, 217, 638460),
    ("2025-09-15", 525, 114562, 60, 638985),
    ("2025-09-22", 850, 117344, 100, 639835),
    ("2025-09-29", 196, 113048, 22, 640031),
    ("2025-10-13", 220, 123561, 27, 640250),
    ("2025-10-20", 168, 112051, 19, 640418),
    ("2025-10-27", 390, 111053, 43, 640808),
    ("2025-11-03", 397, 114771, 46, 641205),
]

def create_holdings_dataset():
    """
    Create a comprehensive dataset of MSTR Bitcoin holdings over time
    """
    holdings_data = []
    
    for purchase in mstr_purchases:
        date, btc_acquired, avg_cost, total_cost_m, cumulative_holdings = purchase
        
        holdings_data.append({
            'date': date,
            'btc_acquired': btc_acquired,
            'avg_acquisition_cost': avg_cost,
            'total_cost_millions': total_cost_m,
            'cumulative_btc_holdings': cumulative_holdings
        })
    
    # Save to JSON
    with open('/home/ubuntu/mstr_btc_holdings.json', 'w') as f:
        json.dump(holdings_data, f, indent=2)
    
    print(f"Created MSTR Bitcoin holdings dataset with {len(holdings_data)} purchase events")
    print(f"Date range: {holdings_data[0]['date']} to {holdings_data[-1]['date']}")
    print(f"Total BTC holdings: {holdings_data[-1]['cumulative_btc_holdings']:,}")
    
    return holdings_data

if __name__ == "__main__":
    create_holdings_dataset()
